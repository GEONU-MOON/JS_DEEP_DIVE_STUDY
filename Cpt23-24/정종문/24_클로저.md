## 클로저 (Closure)

클로저는 함수와 그 함수가 선언됐을 때의 렉시컬 환경(Lexical environment)과의 조합이다.

> 클로저는 함수와 함수가 선언됐을 때의 환경 (렉시컬 환경)을 기억하는 함수다.

이걸 해주려면 변수에 함수를 할당하고, 그 함수를 반환하는 함수를 만들어야 한다.

### \_ 렉시컬 스코프 
> 렉시컬 스코프는 함수를 어디서 호출했는지가 아니라 어디에 선언했는지에 따라 결정된다. 

>렉시컬 스코프는 함수가 정의될 때 결정되는 유효 범위를 의미

### \_ 스코프 체인
> 스코프 체인은 함수가 호출될 때 생성되는데, 이때 함수는 자신의 렉시컬 환경뿐만 아니라 상위 스코프의 렉시컬 환경도 참조할 수 있다.
- 외부렉시컬환경 참조를 통해 클로저를 만들 수 있다.

### \_ 함수객체의 내부슬롯 [[Environment]]
> 함수 객체의 내부슬롯 [[Environment]]는 함수 객체가 정의된 환경을 가리킨다. <br/>이 환경은 함수 객체가 자신의 상위 스코프를 가리킨다.

> 상위에서 아래로 내려가면서 기록해주는 느낌? 하달 롤링페이퍼 
 
#### [[Environment]] 활용 예시
```js
function outer() {
  let outerVar = "외부 변수";

  function inner() {
    console.log(outerVar);
  }

  return inner;
}

let closure = outer();
closure(); // "외부 변수" 출력
```

####  `inner` 함수의 [[Environment]]

```
inner.[[Environment]] = {
  outerVar: "외부 변수",
  outer: <outer 함수 객체에 대한 참조>,
  ... (기타 내장 함수 및 객체)
}
```

-----


#### 클로저란 ? 
> 클로저란 외부 함수보다 내부 함수가 더 오래 유지되는 경우, 외부 함수의 변수에 접근할 수 있는 함수를 말한다. 
(중첩 함수는 이미 생명주기가 끝난 외부 함수의 변수를 참조할 수 있다.)



------


### 클로저의 사용 목적
상태 유지(stateful) -> 의도치 않게 변경되지 않도록 은닉, 특정함수에게만 변경을 허용하기 위해

```js
function closure() {
  let x = 0;
  return function increment() {
    return x++;
  };
}

const increment = closure();
const increment_2 = closure();
console.log(increment()); // 0
console.log(increment()); // 1
console.log(increment()); // 2

console.log(increment_2()); // 0  -> 3이 아닌 0이 출력된다. increment_2() 함수는 increment() 함수와는 별개의 클로저를 생성
console.log(increment_2()); // 1
```

------



#### 렉시컬 환경의 하달식 형성 과정

1. 전역 렉시컬 환경 생성: 자바스크립트 코드 실행 시작 시, 가장 먼저 전역 렉시컬 환경이 생성됩니다. 이 환경에는 전역 변수, 함수 선언 등의 정보가 담깁니다.

2. 외부 함수 실행: 외부 함수가 실행되면 해당 함수의 렉시컬 환경이 생성됩니다. 이 렉시컬 환경은 자신의 [[Environment]] 내부 슬롯에 전역 렉시컬 환경에 대한 참조를 저장하고, 자신의 지역 변수, 매개변수, arguments 객체 등의 정보를 추가합니다.

3. 중첩 함수 실행: 외부 함수 내부에서 중첩 함수가 실행되면, 해당 중첩 함수의 렉시컬 환경이 생성됩니다. 이 렉시컬 환경은 자신의 [[Environment]] 내부 슬롯에 외부 함수의 렉시컬 환경에 대한 참조를 저장하고, 자신의 지역 변수, 매개변수, arguments 객체 등의 정보를 추가합니다.

